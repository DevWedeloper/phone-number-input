---
interface Link {
  label: string
  href: string
}

const { links } = Astro.props as { links: Link[] }
---

<nav class="relative border-b border-(--sl-color-hairline)">
  <div class="flex gap-1" id="tabs">
    {
      links.map((link) => (
        <a href={link.href} data-tab class="px-10 py-3 text-sm font-medium no-underline transition-colors">
          {link.label}
        </a>
      ))
    }
  </div>

  <span
    id="tab-indicator"
    class="ready absolute bottom-0 left-0 h-0.5 bg-(--sl-color-accent) transition-transform duration-300 ease-out"
    transition:persist
  >
  </span>
</nav>

<script is:inline>
  function updateActiveTab() {
    const pathname = window.location.pathname
    const tabs = document.querySelectorAll('[data-tab]')

    let activeTab = null

    tabs.forEach((tab) => {
      const href = tab.getAttribute('href')
      const isActive = pathname === href || pathname.endsWith(href)

      tab.toggleAttribute('data-active', isActive)
      tab.setAttribute('aria-current', isActive ? 'page' : 'false')

      if (isActive) {
        activeTab = tab
      }
    })

    return activeTab
  }

  function moveIndicator(tab) {
    const indicator = document.getElementById('tab-indicator')
    if (!indicator || !tab) {
      return
    }

    const tabRect = tab.getBoundingClientRect()
    const parentRect = tab.parentElement.getBoundingClientRect()

    indicator.style.width = `${tabRect.width}px`
    indicator.style.transform = `translateX(${tabRect.left - parentRect.left}px)`
  }

  function syncIndicator() {
    const activeTab = updateActiveTab()
    moveIndicator(activeTab)

    const indicator = document.getElementById('tab-indicator')
    if (indicator && indicator.classList.contains('ready')) {
      requestAnimationFrame(() => {
        indicator.classList.remove('ready')
      })
    }
  }

  // Initial load
  syncIndicator()

  // After Astro navigation
  document.addEventListener('astro:after-swap', syncIndicator)
</script>

<style is:global>
  .ready {
    transition: none !important;
  }
</style>
